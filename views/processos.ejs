<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>SGAU | Processos</title>
    <link href="/processos.css" rel="stylesheet" type="text/css" />
  </head>
  <body>

    <script>
      function fillForm(curso, numeroAluno, entidade, anoLetivo, pedido, assunto) {
        document.getElementById('curso').value = curso;
        document.getElementById('numAluno').value = numeroAluno;
        document.getElementById('entidade').value = entidade;
        document.getElementById('anoLetivo').value = anoLetivo;
        document.getElementById('pedidos').value = pedido;
        document.getElementById('assunto').value = assunto;

        document.getElementById('submit_btn').disabled = true;
      }
      
      function fillFormNew(curso, numeroAluno, entidade, anoLetivo, pedido, assunto) {
        document.getElementById('curso').value = curso;
        document.getElementById('numAluno').value = numeroAluno;
        document.getElementById('entidade').value = entidade;
        document.getElementById('anoLetivo').value = anoLetivo;
        document.getElementById('pedidos').value = pedido;
        document.getElementById('assunto').value = assunto;

        document.getElementById('submit_btn').disabled = false;
      }
  </script>
  

    <div class="navbar">
      <% if (user.tipo == 'Aluno' || user.tipo == 'DC' || user.tipo == 'AA' || user.tipo == 'PAA') { %>
          <label class="col_sel">Processos</label>
        <% } %>
        <% if (user.tipo == 'Aluno' || user.tipo == 'Regente') { %>
          <label class="col" onclick="location.href='http://localhost:3000/pautas';">Pautas Escolares</label>
        <% } %>
        <% if (user.tipo == 'DC') { %>
          <label class="col" onclick="location.href='http://localhost:3000/pautas';">Pautas de Colocados</label>
        <% } %>
        <% if (user.tipo == 'Candidato') { %>
            <label class="col_sel">Candidatura</label>
        <% } %>
        <label class="col" onclick="location.href='http://localhost:3000/informacao';">Informação Pública</label>
        <label class="col_log" onclick="location.href='http://localhost:3000/login';">Logout <%= user.name.split(' ')[0] %></label>
    </div>

    <% if(user.tipo == 'Aluno' || user.tipo == 'Candidato') {%>

      <br>

      <div width="100%" style="display: flex;">
        
        <div class="border_processos_historico">

          <% if (processos) { %>
            <ul>
                <li onclick="fillFormNew('<%= user.curso %>', '<%= user.numeroAluno %>', '<%= user.name %>', ' ', ' ', ' ', ' ')">
                  <label style="color: blue;">Criar novo processo</label> 
                </li>
              <% processos.forEach(processo => { %>
                <li id="processo_<%= processo._id %>" onclick="fillForm('<%= processo.curso %>', '<%= processo.numeroAluno %>', '<%= processo.entidade %>', '<%= processo.anoLetivo %>', '<%= processo.pedido %>', '<%= processo.assunto %>', '<%= processo.ficheiro %>')">
                  Processo: <%= processo.pedido %> <br>Estado: <label style="color: red;"><%= processo.estado %></label>
              </li>
              <% }); %>
            </ul>
          <% } else {%>
            <h1>Tinha de ser criar novo processo</h1>
          <% } %>

        </div>


        <div class="border_criar_processo" width="80%">

          <% if(user.tipo == 'Aluno') {%>

            <form action="/processos" method="POST">

              <div class="processos_form">
                <label>Curso: </label>
                <input style="margin-left: 12.65%;" type="text" id="curso" name="curso" value = "<%= user.curso %>" readonly/>
              </div>
              <div class="processos_form">
                <label>Número de aluno: </label>
                <input style="margin-left: 1.8%;" type="text" id="numAluno" name="numAluno" value = "<%= user.numeroAluno %>" readonly/>
              </div>
              <div class="processos_form">
                <label>Entidade: </label>
                <input style="margin-left: 9.85%;" type="text" id="entidade" name="entidade" value = "<%= user.name %>" readonly/>
              </div>
              <div class="processos_form">
                <label>Ano Lectivo: </label>
                <input style="margin-left: 7.15%;" type="text" id="anoLetivo" name="anoLetivo" required/>
              </div>
              <div class="processos_form">
                <label>Pedido: </label>
                <select name = "pedidos" id="pedidos" required style="margin-left: 11.9%;">
                  <option value = ""> </option>
                  <option value="Alteração de Inscrição (por via de creditações)">Alteração de Inscrição (por via de creditações)</option>
                  <option value="Anulação de Matrícula/Inscrição">Anulação de Matrícula/Inscrição</option>
                  <option value="Anulação de Unidades Curriculares (Será recusado se existirem pautas lançadas)">Anulação de Unidades Curriculares (Será recusado se existirem pautas lançadas)</option>
                  <option value="Carta de agregação (Diploma) (150.00 Eur)">Carta de agregação (Diploma) (150.00 Eur)</option>
                  <option value="Certificado Aproveitamento  Escolar (10.00 Eur)">Certificado Aproveitamento  Escolar (10.00 Eur)</option>
                </select>
              </div>
              <div class="processos_form">
                <label>Assunto: </label>
                <input style="margin-left: 10.6%; columns: 20;" type="textarea" id="assunto" name="assunto"/>
              </div>
              <div class="processos_form">
                <label>Anexar Documento: </label>
                <input type="file" id="ficheiro" name="ficheiro"/>
              </div>
        
              <input type="hidden" id="userId" name="userId" value ="<%= user._id %>">
        
              <div class="submit_form">
                <button id="submit_btn" name="submit_btn" type="submit">Submeter</button>
              </div> 
            </form>
          <% } else {%>

            <form action="/processos" method="POST">

              <div class="processos_form">
                <label>Nome do Candidato: </label>
                <input type="text" id="name" name="entidade" value = "<%= user.name %>" readonly/>
              </div>
              <div class="processos_form">
                <label>Pedido: </label>
                <input type="text" id="pedido" name="pedido" value = "Candidatura a curso" readonly/>
              </div>
              <div class="processos_form">
                <label>Tipo de Candidatura: </label>
                <select name="tipoCandidatura" id="tipoCandidatura">
                  <option value="Mestrado">Mestrado</option>
                  <option value="Doutoramento">Doutoramento</option>
                </select>
              </div>
              <div class="processos_form">
                <label>Curso: </label>
                <select name="curso" id="curso">
                  <option value="Engenharia Informática">Engenharia Informática</option>
                  <option value="Engenharia Eletrónica">Engenharia Eletrónica</option>
                </select>
              </div>
              <div class="processos_form">
                <label>Assunto: </label>
                <input style="margin-left: 10.6%; columns: 20;" type="textarea" id="assunto" name="assunto"/>
              </div>
              <div class="processos_form">
                <label>Anexar Documento: </label>
                <input type="file" id="ficheiro" name="ficheiro"/>
              </div>
        
              <input type="hidden" id="userId" name="userId" value ="<%= user._id %>">
        
              <div class="submit_form">
                <button type="submit">Submeter</button>
              </div> 
            </form>
          <% } %>
        </div>
      </div>

    
  <% } else {%>
    <div>
      <table width="100%"> 
          <tbody>
            <tr height="60">
              <td width="100%">
                <h1>Processos a Validar</h1>
              </td>
            </tr>
          </tbody>
      </table>
    </div>

    <% if (processos) { %>
      <form action="/processosValidar" method="POST">
        <ul class="processos">
          <% processos.forEach(processo => { %>
            <% if(user.tipo == "AA" && (processo.estado == "Submetido para validação" || processo.estado == "Retornado para revisão" || processo.estado == "Validado por PAA" || processo.estado == "Validado por DC")) {%>
              <input type="radio" id="processoId" name="processoId" value="<%= processo._id %>">
              <li>
                Processo de "<%= processo.pedido %>" <br>Estado: <%= processo.estado %>
              </li>
            <% } %> 
            <% if(user.tipo == "DC" && processo.estado == "Submetido para validação do DC" && processo.curso == user.curso) {%>
              <input type="radio" id="processoId" name="processoId" value="<%= processo._id %>">
              <li>
                Processo de "<%= processo.pedido %>" <br>Estado: <%= processo.estado %>
              </li>
            <% } %> 
            <% if(user.tipo == "PAA" && processo.estado == "Submetido para validação do PresidenteAA") {%>
              <input type="radio" id="processoId" name="processoId" value="<%= processo._id %>">
              <li>
                Processo de "<%= processo.pedido %>" <br>Estado: <%= processo.estado %>
              </li>
            <% } %>
          <% }); %>
          <button type="submit" class="buttonValidar">Submit</button>
        </ul>
      </form>
    <% } else {%>
      <h1>Não existem processos acadêmicos</h1>
    <% } %>

  <% } %>

</body>
</html>